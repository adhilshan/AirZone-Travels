<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airzone | Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;family=Manrope:wght@200..800&amp;family=Montez&amp;display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/fontawesome.min.css" />
    <link rel="stylesheet" href="/assets/css/magnific-popup.min.css" />
    <link rel="stylesheet" href="/assets/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/villoz.css" />
    <link
      rel="stylesheet"
      href="/assets/vendors/bootstrap/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="/assets/vendors/bootstrap-select/bootstrap-select.min.css"
    />
    <link rel="stylesheet" href="/assets/vendors/animate/animate.min.css" />
    <link rel="stylesheet" href="/assets/vendors/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="/assets/vendors/jquery-ui/jquery-ui.css" />
    <link rel="stylesheet" href="/assets/vendors/jarallax/jarallax.css" />
    <link
      rel="stylesheet"
      href="/assets/vendors/jquery-magnific-popup/jquery.magnific-popup.css"
    />
    <link
      rel="stylesheet"
      href="/assets/vendors/nouislider/nouislider.min.css"
    />
    <link
      rel="stylesheet"
      href="/assets/vendors/nouislider/nouislider.pips.css"
    />
    <link rel="stylesheet" href="/assets/vendors/tiny-slider/tiny-slider.css" />
    <link rel="stylesheet" href="/assets/vendors/villoz-icons/style.css" />
    <link
      rel="stylesheet"
      href="/assets/vendors/owl-carousel/css/owl.carousel.min.css"
    />
    <link
      rel="stylesheet"
      href="/assets/vendors/owl-carousel/css/owl.theme.default.min.css"
    />
    <link rel="stylesheet" href="/newstyle.css">
    <link rel="stylesheet" href="/assets/css/universal.css">
</head>
<body>
    <header></header>
    <main id="app">
        <section
        class="position-relative bg-top-center overflow-hidden space"
        id="offers-sec"
        data-bg-src="/assets/img/bg/tour_bg_1.jpg"
        style="padding: 50px 20px;"
      >
        <div class="container" style="margin-top:70px;">
          <div class="row">
            <div class="col-lg-6 offset-lg-3">
              <div class="title-area text-center">
                <span class="sub-title">Best Offers For You</span>
                <h2 class="sec-title">Browse through our offered price charts</h2>
              </div>
            </div>
          </div>
          <div class="grid-offers">
            
            
          </div>
        </div>
      </section>

    </main>
    <footer></footer>
    
    <!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="flightModal" tabindex="-1" aria-labelledby="flightModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="flightModalLabel" style="display: flex; align-items: center; gap: 10px;">
          Flight Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="display:grid; grid-template-columns: repeat(2 , 1fr); gap:20px; padding: 10px 30px;">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
<script src="/lib/router.js" type="module"></script>
<script src="/assets/js/vendor/jquery-3.6.0.min.js"></script>
<script src="/assets/js/swiper-bundle.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/jquery.counterup.min.js"></script>
<script src="/assets/js/jquery-ui.min.js"></script>
<script src="/assets/js/imagesloaded.pkgd.min.js"></script>
<script src="/assets/js/isotope.pkgd.min.js"></script>
<script src="/assets/js/gsap.min.js"></script>
<script src="/assets/js/circle-progress.js"></script>
<script src="/assets/js/matter.min.js"></script>
<script src="/assets/js/matterjs-custom.js"></script>
<script src="/assets/js/nice-select.min.js"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/vendors/jquery/jquery-3.7.0.min.js"></script>
<script src="/assets/vendors/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendors/bootstrap-select/bootstrap-select.min.js"></script>
<script src="/assets/vendors/jarallax/jarallax.min.js"></script>
<script src="/assets/vendors/jquery-ui/jquery-ui.js"></script>
<script src="/assets/vendors/jquery-ajaxchimp/jquery.ajaxchimp.min.js"></script>
<script src="/assets/vendors/jquery-appear/jquery.appear.min.js"></script>
<script src="/assets/vendors/jquery-circle-progress/jquery.circle-progress.min.js"></script>
<script src="/assets/vendors/jquery-magnific-popup/jquery.magnific-popup.min.js"></script>
<script src="/assets/vendors/jquery-validate/jquery.validate.min.js"></script>
<script src="/assets/vendors/nouislider/nouislider.min.js"></script>
<script src="/assets/vendors/tiny-slider/tiny-slider.js"></script>
<script src="/assets/vendors/wnumb/wNumb.min.js"></script>
<script src="/assets/vendors/owl-carousel/js/owl.carousel.min.js"></script>
<script src="/assets/vendors/wow/wow.js"></script>
<script src="/assets/vendors/tilt/tilt.jquery.js"></script>
<script src="/assets/vendors/simpleParallax/simpleParallax.min.js"></script>
<script src="/assets/vendors/imagesloaded/imagesloaded.min.js"></script>
<script src="/assets/vendors/isotope/isotope.js"></script>
<script src="/assets/vendors/countdown/countdown.min.js"></script>
<script src="/assets/vendors/jquery-circleType/jquery.circleType.js"></script>
<script src="/assets/vendors/jquery-lettering/jquery.lettering.min.js"></script>
<script src="/assets/js/villoz.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-storage.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.15.5-0/firebase.js"></script>
<script
  src="https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js"
  type="module"
></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  .banner-three__title{
    font-weight: 600;
    width: 70%;
    max-width: 500px;
  }
  @media screen and (max-width:800px) {
	.banner-three__thumb__left img{
		display: none;
		border-radius: 10px;
	}
	.banner-three__thumb__right img{
		display: none;
		border-radius: 10px;
	}
}
</style>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCV1Z8-EZWdUwPnsAiPrRn6hScbt9_AnHs",
  authDomain: "kaisonline.firebaseapp.com",
  projectId: "kaisonline",
  storageBucket: "kaisonline.appspot.com",
  messagingSenderId: "1038384566126",
  appId: "1:1038384566126:web:0a2dab22a90c750066bb7f",
  measurementId: "G-336STKC5HQ",
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();

function generateFlightCard(date) {
  return `
    <ul class="list-group col-12" style="border: 1px solid #CCCCCC; border-radius: 10px; overflow:hidden;">
      <div style="display: flex;">
        <div class="col-4" style="padding: 10px; border-right: 1px solid #CCCCCC;">
          <div style="background: #1F3C42; color: #FFFFFF; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 10px;">
            <span style="text-align: center;">${date.month}</span>
            <span class="date" style="font-weight: 600; font-size: 2rem;">
              ${date.day}
            </span>
            <span style="text-align: center;">${date.year}</span>
          </div>
        </div>
        <div class="col-8">
          <li class="list-group-item" style="border: none;">
            <svg width="25px" height="25px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier"> 
                <g> 
                  <path fill="none" d="M0 0h24v24H0z"></path> 
                  <path d="M10.478 11.632L5.968 4.56l1.931-.518 6.951 6.42 5.262-1.41a1.5 1.5 0 0 1 .776 2.898L5.916 15.96l-.776-2.898.241-.065 2.467 2.445-2.626.704a1 1 0 0 1-1.133-.48L1.466 10.94l1.449-.388 2.466 2.445 5.097-1.366zM4 19h16v2H4v-2z"></path> 
                </g> 
              </g>
            </svg>
            ${date.from} ${date.fromTime}</li>
          <hr style="margin: 0;">
          <li class="list-group-item" style="border: none;">
            <svg width="25px" height="25px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier"> 
                <g> 
                  <path fill="none" d="M0 0h24v24H0z"></path> 
                  <path d="M10.254 10.47l-.37-8.382 1.933.518 2.81 9.035 5.261 1.41a1.5 1.5 0 1 1-.776 2.898L4.14 11.937l.776-2.898.242.065.914 3.35-2.627-.703a1 1 0 0 1-.74-.983l.09-5.403 1.449.388.914 3.351 5.096 1.366zM4 19h16v2H4v-2z"></path> 
                </g> 
              </g>
            </svg>
            ${date.to} ${date.toTime}</li>
          <hr style="margin: 0;">
          <li class="list-group-item" style="border: none;">Price : ₹${date.price} | <span><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.49345 20.6479C7.51319 21.2133 7.66933 21.6323 8.10814 22.0415C8.54695 22.4507 8.97589 22.5773 9.54124 22.5575C10.1066 22.5378 10.5256 22.3816 10.9348 21.9428C11.344 21.504 11.4706 21.0751 11.4508 20.5097C11.4311 19.9444 11.2018 19.4571 10.8361 19.1161C10.4705 18.7751 9.96838 18.5804 9.40304 18.6001C8.8377 18.6199 8.41863 18.776 8.00943 19.2148C7.60023 19.6536 7.4737 20.0826 7.49345 20.6479ZM2.8406 13.0275C2.4996 13.3932 2.30487 13.8952 2.32461 14.4606C2.34436 15.0259 2.57363 15.5132 2.93931 15.8542L12.4873 5.61525C12.1216 5.27425 11.6195 5.07952 11.0542 5.09926C10.4889 5.119 10.0016 5.34828 9.66058 5.71396L2.8406 13.0275ZM21.7481 7.41447L18.8227 4.68647C18.4817 5.05215 18.287 5.55423 18.3067 6.11957C18.3264 6.68491 18.5557 7.17218 18.9214 7.51318L16.8754 9.70724L13.2186 6.29725L3.67066 16.5362L6.74235 19.4006C6.93708 18.8985 7.14168 18.6791 7.27808 18.5328C7.82368 17.9478 8.52048 17.6404 9.36849 17.6108C10.2165 17.5812 10.933 17.8392 11.5181 18.3848L21.7481 7.41447Z" fill="black"/>
</svg> ${date.luggage}</span></li>
        </div>
      </div>
      <button type="button" class="btn btn-primary book-flight" data-flight-id="${date.id}" style="border-radius: 0 0 8px 8px; background: #1F3C42; border:none;">Book Now</button>
    </ul>
  `;
}

function updateFlightModal(flight) {
  document.getElementById('flightModalLabel').innerHTML = `
    <img src="${flight.logo}" alt="" style="height: 30px; object-fit: contain;">
    Flight Details - ${flight.takeoffShort} to ${flight.landShort}
  `;

  const modalBody = document.querySelector('#flightModal .modal-body');
  modalBody.innerHTML = flight.dates.map(date => generateFlightCard(date)).join('');

  document.querySelectorAll('.book-flight').forEach(button => {
    button.addEventListener('click', (e) => {
      const flightId = e.target.dataset.flightId;
      handleBooking(flightId);
    });
  });
}

async function getFlightData(fromCode, toCode) {
  try {
    const flightRef = db.collection('airzone/flights/offers')
      .where('takeoffShort', '==', fromCode)
      .where('landShort', '==', toCode);
    
    const snapshot = await flightRef.get();
    
    if (snapshot.empty) {
      console.log('No matching flights');
      return null;
    }

    const flightDoc = snapshot.docs[0];
    const flightData = flightDoc.data();

    const datesSnapshot = await db.collection('airzone/flights/offers')
      .doc(flightDoc.id)
      .collection('dates')
      .get();

    const dates = [];
    datesSnapshot.forEach(doc => {
      dates.push({
        id: doc.id,
        ...doc.data()
      });
    });

    return {
      ...flightData,
      dates
    };
  } catch (error) {
    console.error('Error fetching flight data:', error);
    return null;
  }
}

async function handleBooking(flightId) {
  try {
    
    const Toast = Swal.mixin({
      toast: true,
      position: "bottom-end",
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true
    });
    
    Toast.fire({
      icon: "success",
      title: "Starting booking process..."
    });
  } catch (error) {
    console.error('Error booking flight:', error);
    
    const Toast = Swal.mixin({
      toast: true,
      position: "bottom-end",
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true
    });
    
    Toast.fire({
      icon: "error",
      title: "Error booking flight"
    });
  }
}

async function initializeFlightCards() {
  try {
    const snapshot = await db.collection('airzone/flights/offers').get();
    
    const flightCardsContainer = document.querySelector('.grid-offers');
    flightCardsContainer.innerHTML = '';
    
    snapshot.forEach(doc => {
      const flight = doc.data();
      const card = `
        <div class="child" data-bs-toggle="modal" data-bs-target="#flightModal" data-from="${flight.takeoffShort}" data-to="${flight.landShort}">
          <div class="a0">
            <img src="${flight.logo}" alt="">
          </div>
          <div class="a1">
            <span>${flight.takeoffShort}</span>
            <svg version="1.1" id="svg2" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" sodipodi:docname="plane.svg" inkscape:version="0.48.4 r9939" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30px" height="30px" viewBox="-48 -48 1296.00 1296.00" enable-background="new 0 0 1200 1200" xml:space="preserve" fill="#303030" stroke="#303030" stroke-width="0.012" transform="rotate(0)">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier"> 
                <path id="path16765" inkscape:connector-curvature="0" d="M321,1164h120l269.28-480.06H1020c0,0,180,0,180-83.94c0-84-180-84-180-84 H710.28L441,36H321l149.28,480H255.06L120,395.94H0l96.06,204L0,804h120l135.06-120.06h215.22L321,1164z"></path> 
              </g>
            </svg>
            <span>${flight.landShort}</span>
          </div>
          <hr style="margin: 8px 0;">
          <div class="a2">
            ${flight.takeoffFull} to ${flight.landFull}
          </div>
        </div>
      `;
      flightCardsContainer.innerHTML += card;
    });

    document.querySelectorAll('.child[data-bs-toggle="modal"]').forEach(card => {
      card.addEventListener('click', async () => {
        const fromCode = card.dataset.from;
        const toCode = card.dataset.to;
        
        const flightData = await getFlightData(fromCode, toCode);
        if (flightData) {
          updateFlightModal(flightData);
        } else {
          const Toast = Swal.mixin({
            toast: true,
            position: "bottom-end",
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
          });
          
          Toast.fire({
            icon: "error",
            title: "No flights found for this route"
          });
        }
      });
    });
  } catch (error) {
    console.error('Error initializing flight cards:', error);
  }
}
initializeFlightCards();

</script>
</html>